# DB-Lab- PROGRAM 1

CREATE TABLE PUBLISHER(
NAME VARCHAR(18) PRIMARY KEY,
ADDRESS VARCHAR(10),
PHONE VARCHAR(10));

CREATE TABLE BOOK(
BOOK_ID INTEGER PRIMARY KEY,
TITLE VARCHAR(20),
PUBLISHER_NAME VARCHAR(20), 
PUB_YEAR NUMBER(4),
FOREIGN KEY(PUBLISHER_NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE
);

CREATE TABLE BOOK_AUTHORS(
BOOK_ID INTEGER,
AUTHOR_NAME VARCHAR(20),
PRIMARY KEY(BOOK_ID),
FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE);

CREATE TABLE LIBRARY_BRANCH(
BRANCH_ID INTEGER PRIMARY KEY, 
BRANCH_NAME VARCHAR (12),
ADDRESS VARCHAR (20));

CREATE table BOOK_COPIES(
BOOK_ID INTEGER, 
BRANCH_ID INTEGER,
NO_OF_COPIES INTEGER,
FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
PRIMARY KEY (BOOK_ID, BRANCH_ID));


CREATE TABLE BOOK_LENDING(
BOOK_ID INTEGER,
BRANCH_ID INTEGER,
Card_No INTEGER,
Date_Out DATE, 
Due_Date DATE,
PRIMARY KEY (CARD_NO, BRANCH_ID, BOOK_ID),
FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE); 

INSERT INTO PUBLISHER VALUES('PEARSON','BANGALORE','9875462530'); 
INSERT INTO PUBLISHER VALUES('MCGRAW','NEWDELHI','7845691234'); 
INSERT INTO PUBLISHER VALUES('SAPNA','BANGALORE','7845963210');

INSERT INTO BOOK VALUES(101, 'SE', 'PEARSON', 2005);
INSERT INTO BOOK VALUES(202, 'DBMS', 'MCGRAW', 2004);
INSERT INTO BOOK VALUES(303, 'ANOTOMY', 'PEARSON', 2010); 
INSERT INTO BOOK VALUES(404, 'ENCYCLOPEDIA', 'SAPNA', 2010);

INSERT into BOOK_AUTHORS VALUES(101, 'SOMMERVILLE');
INSERT into BOOK_AUTHORS VALUES(202, 'NAVATHE');
INSERT into BOOK_AUTHORS VALUES(303, 'HENRY GRAY');
INSERT into BOOK_AUTHORS VALUES(404, 'THOMAS');

INSERT INTO LIBRARY_BRANCH VALUES(11,'CENTRAL TECHNICAL', 'MG ROAD');
INSERT INTO LIBRARY_BRANCH VALUES(22,'MEDICAL', 'BH ROAD');
INSERT INTO LIBRARY_BRANCH VALUES(33,'CHILDREN', 'SS PURAM');
INSERT INTO LIBRARY_BRANCH VALUES(44,'SECRETARIAT', 'SIRAGATE');
INSERT INTO LIBRARY_BRANCH VALUES(55,'GENERAL', 'JAYNAGAR');

INSERT INTO BOOK_COPIES VALUES(101, 11, 5);
INSERT INTO BOOK_COPIES VALUES(303, 22, 6);
INSERT INTO BOOK_COPIES VALUES(404, 33, 10);
INSERT INTO BOOK_COPIES VALUES(202, 11, 12);
INSERT INTO BOOK_COPIES VALUES(404, 55, 3);

INSERT INTO BOOK_LENDING VALUES(202,11,1,'10-JAN-2017','20-AUG-2017');
INSERT INTO BOOK_LENDING VALUES(303,22,2,'09-JUL-2017','12-AUG-2017');
INSERT INTO BOOK_LENDING VALUES(404,55,1,'11-APR-2017','09-AUG-2017');
INSERT INTO BOOK_LENDING VALUES(202,11,5,'09-AUG-2017','19-AUG-2017');
INSERT INTO BOOK_LENDING VALUES(404,33,1,'10-JUN-2017','15-AUG-2017');
INSERT INTO BOOK_LENDING VALUES(101,11,1,'12-MAY-2017','10-JUN-2017');
INSERT INTO BOOK_LENDING VALUES(303,22,1,'10-JUL-2017','15-JUL-2017');

SELECT * FROM BOOK_LENDING;

-- QUERY1 
SELECT LB.BRANCH_NAME, B.BOOK_ID,TITLE, PUBLISHER_NAME,AUTHOR_NAME, NO_OF_COPIES
FROM BOOK B, BOOK_AUTHORS BA, BOOK_COPIES BC, LIBRARY_BRANCH LB 
WHERE B.BOOK_ID = BA.BOOK_ID 
AND BA.BOOK_ID = BC.BOOK_ID 
AND BC.BRANCH_ID = LB.BRANCH_ID

-- QUERY2 

SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '01-JAN-2017' AND '30-JUN-2017'
GROUP BY CARD_NO
HAVING COUNT(*) > 3;

-- QUERY3 
DELETE FROM BOOK
WHERE BOOK_ID = '303';

SELECT * FROM BOOK;

-- QUERY4
CREATE VIEW V_PUBLICATION AS
SELECT PUB_YEAR
FROM BOOK;

SELECT * FROM V_PUBLICATION;

-- QUERY5
CREATE VIEW BOOKS_AVAILABLE AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM LIBRARY_BRANCH L, BOOK B, BOOK_COPIES C
WHERE B.BOOK_ID = C.BOOK_ID AND
L.BRANCH_ID=C.BRANCH_ID;

SELECT * FROM BOOKS_AVAILABLE;

